class IrisUtils{static async checkStorageQuota(){try{if(!navigator.storage||!navigator.storage.estimate)throw new Error("Storage API no soportada en este navegador");const t=await navigator.storage.estimate(),a=t.quota,e=t.usage,r=a-e;return{total:a,used:e,available:r,percentageUsed:e/a*100,formattedTotal:this.formatStorage(a),formattedUsed:this.formatStorage(e),formattedAvailable:this.formatStorage(r)}}catch(t){throw new Error(`Error al verificar almacenamiento: ${t.message}`)}}static formatStorage(t){if(0===t)return"0 Bytes";const a=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.round(t/Math.pow(1024,a),2)+" "+["Bytes","KB","MB","GB","TB"][a]}static async getDatabaseSize(t){try{const a=await window.indexedDB.databases();if(!a.find((a=>a.name===t)))throw new Error("Base de datos no encontrada");const e=await navigator.storage.estimate();return{databaseName:t,approximateSize:e.usage,formatted:this.formatStorage(e.usage)}}catch(t){throw new Error(`Error al obtener tamaÃ±o de la base de datos: ${t.message}`)}}static async checkBrowserSupport(){return{indexedDB:!!window.indexedDB,storageAPI:!(!navigator.storage||!navigator.storage.estimate),serviceWorker:"serviceWorker"in navigator,webWorker:!!window.Worker,browserInfo:this.getBrowserInfo(),storageQuota:await this.checkStorageQuota().catch((()=>null))}}static getBrowserInfo(){const t=navigator.userAgent;let a,e;a=t.match(/chrome|chromium|crios/i)?"Chrome":t.match(/firefox|fxios/i)?"Firefox":t.match(/safari/i)?"Safari":t.match(/opr\//i)?"Opera":t.match(/edg/i)?"Edge":"Unknown";const r=t.match(/(chrome|safari|firefox|opera|edge?)\/?\s*(\d+)/i);return e=r?r[2]:"Unknown",{name:a,version:e,userAgent:t}}static async monitorStorageChanges(t,a=5e3){let e=(await this.checkStorageQuota()).used;return setInterval((async()=>{const a=await this.checkStorageQuota();a.used!==e&&t&&t({previous:e,current:a.used,difference:a.used-e,formattedDifference:this.formatStorage(a.used-e)}),e=a.used}),a)}static async cleanup(t,a={}){const{olderThan:e=2592e6,maxEntries:r=null,minSpaceRequired:o=104857600}=a;if((await this.checkStorageQuota()).available<o){const a=new Date(Date.now()-e);if(t.schema.definition.createdAt||t.schema.definition.updatedAt){const e=t.schema.definition.updatedAt?"updatedAt":"createdAt";await t.deleteMany({[e]:{$lt:a}})}if(r){const a=await t.find();if(a.length>r){const e=a.sort(((t,a)=>(t.updatedAt||t.createdAt)-(a.updatedAt||a.createdAt))).slice(0,a.length-r);for(const a of e)await t.delete(a.id)}}}}static async generateUUIDv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const a=16*Math.random()|0;return("x"===t?a:3&a|8).toString(16)}))}static async generateObjectId(){return Math.floor(Date.now()/1e3).toString(16)+Array.from(crypto.getRandomValues(new Uint8Array(5))).map((t=>t.toString(16).padStart(2,"0"))).join("")+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}}export{IrisUtils};