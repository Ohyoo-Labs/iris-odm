class IrisUtils{static async checkStorageQuota(){try{if(!navigator.storage||!navigator.storage.estimate)throw new Error("Storage API no soportada en este navegador");const t=await navigator.storage.estimate(),e=t.quota,a=t.usage,r=e-a;return{total:e,used:a,available:r,percentageUsed:a/e*100,formattedTotal:this.formatStorage(e),formattedUsed:this.formatStorage(a),formattedAvailable:this.formatStorage(r)}}catch(t){throw new Error(`Error al verificar almacenamiento: ${t.message}`)}}static formatStorage(t){if(0===t)return"0 Bytes";const e=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.round(t/Math.pow(1024,e),2)+" "+["Bytes","KB","MB","GB","TB"][e]}static async getDatabaseSize(t){try{const e=await window.indexedDB.databases();if(!e.find((e=>e.name===t)))throw new Error("Base de datos no encontrada");const a=await navigator.storage.estimate();return{databaseName:t,approximateSize:a.usage,formatted:this.formatStorage(a.usage)}}catch(t){throw new Error(`Error al obtener tamaÃ±o de la base de datos: ${t.message}`)}}static async checkBrowserSupport(){return{indexedDB:!!window.indexedDB,storageAPI:!(!navigator.storage||!navigator.storage.estimate),serviceWorker:"serviceWorker"in navigator,webWorker:!!window.Worker,browserInfo:this.getBrowserInfo(),storageQuota:await this.checkStorageQuota().catch((()=>null))}}static getBrowserInfo(){const t=navigator.userAgent;let e,a;e=t.match(/chrome|chromium|crios/i)?"Chrome":t.match(/firefox|fxios/i)?"Firefox":t.match(/safari/i)?"Safari":t.match(/opr\//i)?"Opera":t.match(/edg/i)?"Edge":"Unknown";const r=t.match(/(chrome|safari|firefox|opera|edge?)\/?\s*(\d+)/i);return a=r?r[2]:"Unknown",{name:e,version:a,userAgent:t}}static async monitorStorageChanges(t,e=5e3){let a=(await this.checkStorageQuota()).used;return setInterval((async()=>{const e=await this.checkStorageQuota();e.used!==a&&t&&t({previous:a,current:e.used,difference:e.used-a,formattedDifference:this.formatStorage(e.used-a)}),a=e.used}),e)}static async cleanup(t,e={}){const{olderThan:a=2592e6,maxEntries:r=null,minSpaceRequired:o=104857600}=e;if((await this.checkStorageQuota()).available<o){const e=new Date(Date.now()-a);if(t.schema.definition.createdAt||t.schema.definition.updatedAt){const a=t.schema.definition.updatedAt?"updatedAt":"createdAt";await t.deleteMany({[a]:{$lt:e}})}if(r){const e=await t.find();if(e.length>r){const a=e.sort(((t,e)=>(t.updatedAt||t.createdAt)-(e.updatedAt||e.createdAt))).slice(0,e.length-r);for(const e of a)await t.delete(e.id)}}}}static async generateUUIDv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}static async generateObjectId(){return Math.floor(Date.now()/1e3).toString(16)+Array.from(crypto.getRandomValues(new Uint8Array(5))).map((t=>t.toString(16).padStart(2,"0"))).join("")+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}static Stringify(t,e,a=null,r=2){return JSON.stringify(t,((t,a)=>e.definition[t]?.type===Date?(alert("Date",a),a.toString()):a),r)}}export{IrisUtils};